def create(self, validated_data):
        profile_data = validated_data.pop('profile')
        user = User.objects.create_user(
            email=validated_data['email'],
            username=validated_data['email'],
            first_name=validated_data['first_name'],
            last_name=validated_data['last_name'],
            password=validated_data['password']
        )
        profile_data['is_social'] = False
        user.profile.cell_phone = profile_data.get('cell_phone', user.profile.cell_phone)
        user.profile.date_of_birth = profile_data.get('date_of_birth', user.profile.date_of_birth)
        user.profile.nationality = profile_data.get('nationality', user.profile.nationality)
        user.profile.address = profile_data.get('address', user.profile.address)
        user.profile.is_social = profile_data.get('is_social', user.profile.is_social)
        user.profile.save()

        # TODO find a way to verify that the mail was properly sent
        self.send_confirmation_mail(User.objects.get(username=user))
        return user